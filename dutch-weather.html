<!-- Config node -->

<script type="text/x-red" data-template-name="dutch-weather-conf">
	<div class="form-row">
		<label for="node-config-input-lat"><i class="fa fa-map-marker"></i> Latitude</label>
		<input type="text" id="node-config-input-lat">
	</div>
	<div class="form-row">
		<label for="node-config-input-lng"><i class="fa fa-map-marker"></i> Longitude</label>
		<input type="text" id="node-config-input-lng">
	</div>
	<div class="form-row">
		<label for="node-config-input-spti"><i class="fa fa-clock-o"></i> Sun position interval</label>
		<input type="text" id="node-config-input-spti"> min
	</div>
	<div class="form-row">
		<label for="node-config-input-rti"><i class="fa fa-clock-o"></i> Rain prediction interval</label>
		<input type="text" id="node-config-input-rti"> min
	</div>
	<div class="form-row">
		<label for="node-config-input-mpti"><i class="fa fa-clock-o"></i> Meteoplaza interval</label>
		<input type="text" id="node-config-input-mpti"> min
	</div>
	<div class="form-row">
		<label for="node-config-input-update"><i class="fa fa-refresh"></i> Fetch on (re)deploy</label>
		<input type="checkbox" id="node-config-input-update"> min
	</div>

</script>

<script type="text/javascript">
	function filterFloat(v) {
		v = (/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/.test(v)) ? Number(v) : NaN;
		return v;
	}

	RED.nodes.registerType('dutch-weather-conf',{
		category: 'config',
		defaults: {
			lat: { value: 51.424080, required: true, validate: function (v) { return !isNaN(filterFloat(v)); } },
			lng: { value: 5.442794, required: true, validate: function (v) { return !isNaN(filterFloat(v)); } },
			spti: { value: 1, required: false, validate: function (v) { return ((v != '') && (!isNaN(Math.sign(v)))); } },
			rti: { value: 5, required: false, validate: function (v) { return ((v != '') && (!isNaN(Math.sign(v)))); } },
			mpti: { value: 10, required: false, validate: function (v) { return ((v != '') && (!isNaN(Math.sign(v)))); } },
			update: { value: true, required: false, validate: function (v) { return ((v != '') && (!isNaN(Math.sign(v)))); } }
		},
		color: '#D3D3D3',
		icon: 'font-awesome/fa-map-marker',
		label: function() {
			return 'Dutch weather for ' + parseFloat(this.lat).toFixed(2) + ',' + parseFloat(this.lng).toFixed(2);
		}
	});
</script>



<!-- Sun position node -->

<script type="text/x-red" data-template-name="dutch-weather-sun-position">
	<div class="form-row">
		<label for="node-input-conf"><i class="fa fa-map-marker"></i> Location configuration</label>
		<input type="text" id="node-input-conf">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-name">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-topic">
	</div>
</script>

<script type="text/x-red" data-help-name="dutch-weather-sun-position">
  <p>Provides the postion of the sun (in angle and elevation) at the interval defined in the configuration node.</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('dutch-weather-sun-position', {
		category: 'Dutch_Weather',
		defaults: {
			conf: { value: '', type: 'dutch-weather-conf', required: true },
			name: { },
			topic: { }
		},
		inputs: 1,
		outputs: 1,
		color: '#ffd700',
		icon: 'font-awesome/fa-location-arrow',
		label: function() {
			return 'Sun position';
		}
	})
</script>



<!-- Sun events node -->

<script type="text/x-red" data-template-name="dutch-weather-solar-events">
	<div class="form-row">
		<label for="node-input-conf"><i class="fa fa-map-marker"></i> Location configuration</label>
		<input type="text" id="node-input-conf">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-name">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-topic">
	</div>
</script>

<script type="text/x-red" data-help-name="dutch-weather-solar-events">
  <p>Provides the postion of the sun (in angle and elevation) as well as solar events at the interval defined in the configuration node.</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('dutch-weather-solar-events', {
		category: 'Dutch_Weather',
		defaults: {
			conf: { value: '', type: 'dutch-weather-conf', required: true },
			name: { },
			topic: { }
		},
		inputs: 1,
		outputs: 1,
		color: '#ffd700',
		icon: 'font-awesome/fa-sun',
		label: function() {
			return 'Solar events';
		}
	})
</script>



<!-- Rain state node -->

<script type="text/x-red" data-template-name="dutch-weather-rain-state">
	<div class="form-row">
		<label for="node-input-conf"><i class="fa fa-map-marker"></i> Location configuration</label>
		<input type="text" id="node-input-conf">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-name">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-topic">
	</div>
</script>

<script type="text/x-red" data-help-name="dutch-weather-rain-state">
  <p>Provides information from the Dutch rain info provider Buienalarm at the interval defined in the configuration node.</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('dutch-weather-rain-state', {
		category: 'Dutch_Weather',
		defaults: {
			conf: { value: '', type: 'dutch-weather-conf', required: true },
			name: { },
			topic: { }
		},
		inputs: 1,
		outputs: 1,
		color: '#4CA3DD',
		icon: 'font-awesome/fa-tint',
		label: function() {
			return 'Rain state';
		}
	})
</script>



<!-- Meteoplaza node -->

<script type="text/x-red" data-template-name="dutch-weather-meteoplaza">
	<div class="form-row">
		<label for="node-input-conf"><i class="fa fa-map-marker"></i> Location configuration</label>
		<input type="text" id="node-input-conf">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-name">
	</div>
	<div class="form-row">
		<input type="hidden" id="node-input-topic">
	</div>
</script>

<script type="text/x-red" data-help-name="dutch-weather-meteoplaza">
  <p>Provides information from the Dutch provider Meteoplaza at the interval defined in the configuration node.</p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('dutch-weather-meteoplaza', {
		category: 'Dutch_Weather',
		defaults: {
			conf: { value: '', type: 'dutch-weather-conf', required: true },
			name: { },
			topic: { }
		},
		inputs: 1,
		outputs: 1,
		color: '#528B8B',
		icon: 'font-awesome/fa-newspaper-o',
		label: function() {
			return 'Meteoplaza';
		}
	})
</script>